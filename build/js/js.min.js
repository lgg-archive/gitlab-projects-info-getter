
var inputs={"forms":{"url":"","token":"","owned":"","starred":"","archived":"","vis":{"vis-all":"","vis-pub":"","vis-int":"","vis-pr":""}},init:function(){for(var index in this["forms"]){if(index==="vis"){for(var vindex in this["forms"]["vis"]){this["forms"]["vis"][vindex]=document.getElementById(vindex);}}else{this["forms"][index]=document.getElementById(index);}}
document.getElementById("parse").addEventListener("click",this.start);document.getElementById("url").addEventListener("keypress",this.key);document.getElementById("token").addEventListener("keypress",this.key);},key:function(event){if(event.which==13||event.keyCode==13){inputs.start();return false;}
return true;},start:function(){'use strict';for(var index in parser.params){switch(index){case"vis":for(var vindex in inputs["forms"]["vis"]){if(inputs["forms"]["vis"][vindex].checked){parser.params.vis=inputs["forms"]["vis"][vindex].value;break;}}
break;case"token":parser.params[index]=inputs.forms[index].value;break;case"url":var url=inputs.forms[index].value;if(url.indexOf("//")>-1){url=url.substr(url.indexOf("//")+2,url.length);}
parser.params[index]=url;break;default:parser.params[index]=inputs.forms[index].checked;break;}}
parser.parse();}};

document.addEventListener('DOMContentLoaded',function(){inputs.init();notifications.init();});

function showLoader(){document.getElementById("dark").classList.add("is-visible");document.getElementById("loader").classList.remove("invisible");}
function hideLoader(){document.getElementById("dark").classList.remove("is-visible");document.getElementById("loader").classList.add("invisible");}

var notifications={"elem":"",init:function(){this.elem=document.getElementById("info");},show:function(mess){'use strict';var data={message:mess};this.elem.MaterialSnackbar.showSnackbar(data);}};

var parser={"params":{"url":"","token":"","owned":"","starred":"","archived":"","vis":""},"fields":{"id":"","name":"","description":""},"gl-api-url":"/api/v3/projects/","response":"",getParams:function(){var params="";if(parser.params.owned){params+="owned";}else{if(parser.params.starred){params+="starred";}}
params+="?";if(parser.params.archived){params+="archived=true&"}
if(parser.params.vis){params+="visibility="+parser.params.vis;}
return params;},parse:function(){if(parser.params.url===""){notifications.show("Empty url");return false;}
if(parser.params.token===""){notifications.show("Empty token");return false;}
var params=parser.getParams();var url="https://"+parser.params.url+this["gl-api-url"]+params;showLoader();get(url,{"PRIVATE-TOKEN":parser.params.token},function(data){hideLoader();try{parser.response=data;parser.response=JSON.parse(parser.response);var info=[];parser.response.forEach(function(item,index){var project={};for(var field in parser.fields){project[field]=item[field];}
info[index]=project;});parser.show(info);}catch(err){console.log(err);notifications.show("Can't parse json from response");}},function(code){hideLoader();switch(code){case-100:notifications.show("Connection error");break;case 401:notifications.show("Bad token [401 error]");break;case 403:notifications.show("Access denied [403 error]");break;case 404:notifications.show("Gitlab api not found [404 error]");break;default:notifications.show("Unknown error ["+code+"]");break;}})},show:function(projects){if(projects.length<1){notifications.show("No projects found");return false;}
var table=document.getElementById("result-content");while(table.firstChild){table.removeChild(table.firstChild);}
var thead=document.createElement('thead');var thead_row=document.createElement('tr');for(var field in parser.fields){var cell=document.createElement('td');cell.textContent=field;thead_row.appendChild(cell);}
thead.appendChild(thead_row);table.appendChild(thead);var tbody=document.createElement('tbody');projects.forEach(function(project,index){var row=document.createElement('tr');for(var field in project){var cell=document.createElement('td');cell.textContent=project[field];row.appendChild(cell);}
tbody.appendChild(row);});table.appendChild(tbody);document.getElementById("result-close").addEventListener("click",parser.hide);document.getElementById("result").classList.remove("hidden");document.getElementById("inputs-wrap").classList.add("hidden");},hide:function(){document.getElementById("result").classList.add("hidden");document.getElementById("inputs-wrap").classList.remove("hidden");}};

function get(url,headers,success,fail){var request=new XMLHttpRequest();request.open('GET',url,true);for(var header in headers){request.setRequestHeader(header,headers[header]);}
request.onload=function(){if(this.status>=200&&this.status<400){success(this.response);}else{fail(this.status);}};request.onerror=function(){fail(-100);};request.send();}